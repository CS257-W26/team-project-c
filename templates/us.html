<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WattWatch USA â€“ All US Data</title>
    <link rel="stylesheet" href="../static/us_style.css">
    <link rel="stylesheet" href="{{url_for('static',filename='main_style.css')}}">
</head>

<body>
    <a class="skip-link" href="#main-content">Skip to main content</a>
    {% include 'header.html' %}
    <main id="main-content">

        <h1>United States Energy Data</h1>

        <div class="content-wrapper">

            <!-- Controls + Data -->
            <section class="centered-section" aria-labelledby="filter-heading">
                
                <h2 id="filter-heading">Filter by Year</h2>

                <form method="GET">
                    <div>
                        <label for="year-select">Choose a year</label>
                        <select 
                            id="year-select"
                            name="year"
                            required
                            aria-describedby="year-description"
                        >
                            <option value="" disabled {% if not selected_year %}selected{% endif %}>
                                Select a year
                            </option>

                            {% for year in years %}
                                <option value="{{ year }}"
                                    {% if year == selected_year %}selected{% endif %}>
                                    {{ year }}
                                </option>
                            {% endfor %}
                        </select>

                        <p id="year-description">
                            Select a year to display national energy generation data.
                        </p>
                    </div>

                    <button type="submit">Update Data</button>
                </form>
                  {% if us_data %}
                <h2 id="table-heading">Energy Data Table</h2>
                <div class="table-wrapper" role="region" aria-live="polite">
                    <table>
                        <tbody>
                            {% for key, value in us_data.items() %}
                            <tr>
                                <th scope="row">{{ key|capitalize }}</th>
                                <td>{{ value }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                    <p>No data loaded. Please select a year.</p>
                {% endif %}
                </div>
            <!-- Graphs -->
        <section class="graph-section" aria-labelledby="graph-heading">
            <h2 id="graph-heading">Price Data Visualization</h2>
            <p>More charts too come...</p>
        
            <!-- Canvas for the chart -->
            <div class="graph-box">
                <canvas id="priceChart"></canvas>
            </div>
        
            <p class="visually-hidden">
                A graphical representation of energy generation by state. 
                Exact values are available in the data table.
            </p>
        </section>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            const us_data = {{ us_data | tojson }};
        
            const priceKeys = Object.keys(us_data)
                .filter(key => key.toLowerCase().includes('price'));
        
            const priceValues = priceKeys.map(key => us_data[key]);
        
            const ctx = document.getElementById('priceChart').getContext('2d');
        
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: priceKeys,       
                    datasets: [{
                        label: 'Price',
                        data: priceValues,
                        backgroundColor: 'rgba(75, 192, 192, 0.6)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { 
                            beginAtZero: true,
                            title: { display: true, text: 'Price Value' }
                        },
                        x: { title: { display: true, text: 'Industrial Category' } }
                    }
                }
            });
        </script>
    </main>

</body>
</html>